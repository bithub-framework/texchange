# 复杂状态一致性问题

假设一个系统的状态特别复杂，以至于

1. 这个状态不得不分为很多个状态块
1. 每个状态块都不得不交给不同人写
1. 负责每个状态块的人都没有精力熟悉别人的的块

对这个系统可以进行很多种操作

1. 每个操作都是异步进行
1. 多个操作可能同时进行
1. 每个操作都要求自己涉及的状态块在操作开始时处于一致状态

每个操作也特别复杂，以至于

1. 每个操作都不得不分为很多个步骤
1. 每个步骤都会修改某些个状态块
1. 每个步骤开始时都会要求指定的一些状态块处于已修改或未修改状态

对于同时进行的不同操作，只需在操作开始时把操作涉及的状态块都上锁就行了。

对于某个操作的不同步骤，需要记录并检查每一个状态块在本次操作中是否已经修改。

# Texchange 状态

Texchange 是单协程，状态块不是临界资源，只需要为每个状态块记录不同步骤是否修改。
